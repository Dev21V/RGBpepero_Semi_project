<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.test1.mapper.RegistryMapper">
	
	
	<select id="selectUserRegistry" parameterType="hashmap" resultType="com.example.mini.model.MyRegistry">
		SELECT
			R.REGISTRYNO,
			R.PRODUCTNO,
			R.TRIPNO,
			R.R_CDATETIME,
			R.R_UDATETIME,
			R.R_OPTION,
			R.R_CONTENT,
			R.USERID,
			R.FUNDYN,
			PI.IMGSRC,
 			TI.IMGSRC,
 			PM.P_STOCK,
  			P.P_NAME,
  			P.P_PRICE
		FROM 
			mini_db2.T1_REGISTRY AS R
		INNER JOIN
			mini_db2.T1_PRODUCT AS P ON R.PRODUCTNO = P.PRODUCTNO
		LEFT JOIN	
			mini_db2.T1_PDIMAGE AS  PI ON P.PRODUCTNO = PI.PRODUCTNO
		INNER JOIN	
			mini_db2.T1_USER AS U ON R.USERID = U.USERID
		LEFT JOIN	
 			mini_db2.T1_TRIP AS T ON R.TRIPNO = T.TRIPNO
   		LEFT JOIN	
   			mini_db2.T1_TRIPIMAGE AS TI ON T.TRIPNO = TI.TRIPNO
 		LEFT JOIN
  			mini_db2.T1_PDMANAGE AS PM ON P.PRODUCTNO = PM.PRODUCTNO
		WHERE 
			R.USERID = #{userId};
	</select>
	<update id="updateRegistryOption" parameterType="hashmap">
		UPDATE mini_db2.T1_REGISTRY
		SET						
			R_OPTION = #{rOption},
			R_CONTENT = #{rContent},
			FUNDYN = #{fundYn},
			R_UDATETIME = #{rUdatetime}			
		WHERE
			REGISTYNO = #{registryNo};
	</update>
	<select id="selectUserImage" parameterType="hashmap" resultType="com.example.mini.model.UserImage">
		SELECT
			SRCIMGNO,
			USERID,
			IMGSRC,
			IMGNAME,
			ORGNAME,
			IMGTYPE,
			IMGUSETYPE			
		FROM
			mini_db2.T1_USERIMAGE
		WHERE 
			USERID = #{userId};
	</select>
	<insert id="saveUserImg" parameterType="hashmap">
		INSERT INTO mini_db2.T1_USERIMAGE
		VALUES
			(#{null}, #{userId}, #{imgSrc}, #{imgName}, #{orgName}, #{imgType}, #{imgUsetype})
			;
	</insert>

	<update id="updateUserImg" parameterType="hashmap">
		UPDATE mini_db2.T1_USERIMAGE
		SET			
			IMGSRC = #{imgSrc},
			IMGNAME = #{imgName},
			ORGNAME = #{orgName},
			IMGTYPE = #{imgType},
			IMGUSETYPE = #{imgUsetype}			
		WHERE
			SRCIMGNO = #{null} AND USERID = #{userId};
	</update>
</mapper>