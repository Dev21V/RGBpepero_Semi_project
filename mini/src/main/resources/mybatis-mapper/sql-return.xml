<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.mini.mapper.ReturnMapper">	
	<select id="selectReturnList" parameterType="hashmap" resultType="com.example.mini.model.Return">
		SELECT
	   		R.PRODUCTNO AS PRODUCTNO,
		    G_NAME,
	        PI.IMGSRC,
	        RC.RETCNT AS RETCNT,
	        RENO,
	        P_PRICE*RETCNT AS PPRICE,
	        R.USERID AS USERID,
	        R.G_PHONE AS G_PHONE,
	        R.CDATETIME AS CDATETIME,
	        P.P_NAME AS P_NAME,
	        R.ORDERNO AS ORDERNO
		FROM  mini_db2.T1_RETURN R
		LEFT JOIN mini_db2.T1_GUEST G ON G.USERID = R.USERID AND G.G_PHONE = R.G_PHONE
		LEFT JOIN mini_db2.T1_PRODUCT P ON P.PRODUCTNO = R.PRODUCTNO
		INNER JOIN mini_db2.T1_PDIMAGE PI ON R.PRODUCTNO = PI.PRODUCTNO
		INNER JOIN (SELECT COUNT(*) AS RETCNT, PRODUCTNO, USERID
					FROM mini_db2.T1_RETURN
		            GROUP BY PRODUCTNO) RC ON RC.PRODUCTNO = R.PRODUCTNO
		WHERE G.USERID = #{userId} AND IMGSRC NOT LIKE '%BackGround%'
		GROUP BY PRODUCTNO
		<!-- LIMIT #{startNum}, 6 -->
		
	</select>
	<select id="selectReturnGuestList" parameterType="hashmap" resultType="com.example.mini.model.Return">
		SELECT 
			G_NAME,
			PRODUCTNO
		FROM mini_db2.T1_RETURN R
		LEFT JOIN mini_db2.T1_GUEST G ON G.USERID = R.USERID AND G.G_PHONE = R.G_PHONE
		WHERE R.USERID = #{userId} AND PRODUCTNO = #{productNo}
		<!-- GROUP BY PRODUCTNO -->
	</select>
</mapper>